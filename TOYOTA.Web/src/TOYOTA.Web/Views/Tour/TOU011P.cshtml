@{
    Layout = "_LayoutOfPop";
    ViewData["Title"] = "得分登记POP";
}
<style>
    body {
        padding-top: 0px;
    }

    #inputNo {
        display: inline !important;
        width: 87px;
    }

    .trash-space {
        padding-right: 5px;
        line-height: 36px;
    }

    .picName {
        display: inline-block;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 150px;
        line-height: 20px;
    }
</style>
@section scripts{
    <!-- 1. Load -->
    <script type="text/javascript">
        var _grid, _gridName;
        var _grid2, _gridName2;
        var _grid3, _gridName3;
        var _grid4, _gridName4;
        var _seqNo;// 记录第几道题
        var _tIId;//哪个体系
        var _tPId;
        var _data;//查询的所有数据
        var _tpStatus;
        var _saveData = { ScoreLst: [], CheckResultLst: [], StandardPicLst: [], StandardAttachmentLst: [], PicStandLst: [], UserId: "@Context.Request.Cookies[SessionKeys.SESSION_USERID]" };//要保存的数据

        $(document).ready(function () {
            fn_Initialize();
            fn_InitGrid();
            fn_InitData();
            //上一题
            $("#btnPre").on("click", function () {
                //fn_saveTempData();
                _seqNo--;
                $("#inputNo").val("");
                fn_BindData(_data, _tPId, _seqNo);
                if (_seqNo == 1) {
                    $(this).attr("disabled", true);
                }
                if (_seqNo < _data.length) {
                    //$("#btnNext").attr("disabled", false);
                }

            });
            //下一题
            $("#btnNext").on("click", function () {
                fn_saveTempData();
                if (_seqNo >= _data.length) {
                    //$(this).attr("disabled", true);
                    $.sa.warning("已是最后一道题，请保存！");
                    _seqNo = _data.length;
                    return;
                } else {
                    _seqNo++;
                    $("#inputNo").val("");
                    fn_BindData(_data, _tPId, _seqNo);
                }
                if (_seqNo > 1) {
                    $("#btnPre").attr("disabled", false);
                }

            });
            //不涉及
            $("#btnQuit").on("click", function () {
                $("#inputScore").val(99);

                for (var i = 0; i < _saveData.ScoreLst.length; i++) {
                    var saveScoreRegDto = _saveData.ScoreLst[i];
                    if (saveScoreRegDto.TPId == _tPId && saveScoreRegDto.TIId == _tIId) {
                        _saveData.ScoreLst[i].Score = $("#inputScore").val();
                        _saveData.ScoreLst[i].GRUD = "I";
                        _saveData.ScoreLst[i].PassYN = "Q";//不涉及
                        break;
                    }
                }

            });
            //跳到第几题
            $("#btnGoto").on("click", function () {
                //fn_saveTempData();

                if (parseInt($("#inputNo").val()) > _data.length) {
                    $.sa.warning("没有对应的题目！");
                    return;
                    //$("#btnNext").attr("disabled", true);
                } else {
                    _seqNo = parseInt($("#inputNo").val());
                }
                //else {
                //    $("#btnNext").attr("disabled", false);
                //}
                if (_seqNo > 1) {
                    $("#btnPre").attr("disabled", false);
                } else {
                    $("#btnPre").attr("disabled", true);
                }
                fn_BindData(_data, _tPId, _seqNo);
            });
            //保存
            $("#btnSave").on("click", function () {
                //fn_saveTempData();
                if (!fn_validateBeforeSave()) {
                    return;
                }
                $.sa.confirm('确定保存吗？', {
                    fnOk: function () {
                        $(".close").click();
                        //$.sa.post("http://toyotaqaapi.elandcloud.com/toyota/api/v1/Tour/SaveCheckResult",
                        $.sa.post(SAVECHECKRESULT,
                             JSON.stringify(_saveData),
                             {
                                 "success": function (data) {
                                     $.sa.alert('保存成功！');
                                     window.parent.popcallback("success");
                                 },
                                 "failure": function (data) {
                                     $.sa.alert("保存失败");
                                 }
                             }, $("body"));
                    }
                });
            });

            $("#inputScore").on("change", function () {
                fn_ScoreChange();
            });

        });
    </script>
    <!-- 2. Init -->
    <script type="text/javascript">
        function fn_Initialize() {
            _gridName = 'gridStandardPic';
            _grid = $('#' + _gridName);

            _gridName2 = 'gridCheckStandard';
            _grid2 = $('#' + _gridName2);

            _gridName3 = 'gridPicUpload';
            _grid3 = $('#' + _gridName3);

            _gridName4 = 'gridAttachmentUpload';
            _grid4 = $('#' + _gridName4);

            $(".form_datetime").datetimepicker({
                format: 'yyyy-mm-dd',
                language: 'zh-CN',
                minView: 2, //显示到具体日期，如果设置到1，则显示到具体时间点。
                autoclose: 1,
                todayHighlight: 1,
                todayBtn: 1,
                startView: 2, //开始页面设置为具体到日期的那个页面。
                pickerPosition: 'bottom-left'
            });


            $("#inputNo").keypress(function (event) {
                var keyCode = event.which;
                if (keyCode == 46 || (keyCode >= 48 && keyCode <= 57) || keyCode == 8)//8是删除键
                    return true;
                else
                    return false;
            }).focus(function () {
                this.style.imeMode = 'inactive';//chrome
                //$(this).css("-webkit-ime-mode", "disabled");
            });

            $("#inputScore").keypress(function (event) {
                var keyCode = event.which;
                if (keyCode == 46 || (keyCode >= 48 && keyCode <= 57) || keyCode == 8)//8是删除键
                    return true;
                else
                    return false;
            }).focus(function () {
                this.style.imeMode = 'inactive';//chrome
                //$(this).css("-webkit-ime-mode", "disabled");
            });

        }
        function fn_InitGrid() {
            fn_GridInit();
            fn_GridInit2();
            fn_GridInit3();
            fn_GridInit4();
        }
        function fn_InitData() {
            _tPId = Request["TPId"];
            _tIId = Request["TIId"];
            _seqNo = Request["SeqNo"];
            fn_SearchScoreInfo(_tPId, _tIId, _seqNo);

        }
        function fn_InitControls() {
            if (_seqNo <= 1) {
                $("#btnPre").attr("disabled", true);
            }
            if (_seqNo == _data.length) {
                //$("#btnNext").attr("disabled", true);
            }
        }

    </script>
    <!-- 3. Validate -->
    <script type="text/javascript">
        function fn_validateBeforeSave() {

            return true;
        }
    </script>

    <!-- 4. Custom Function -->
    <script type="text/javascript">
        function fn_SearchScoreInfo(_tPId, _tIId, _seqNo) {
            //$.sa.get("http://toyotaqaapi.elandcloud.com/toyota/api/v1/Tour/GetItemListByTaskId",
            $.sa.get(GETITEMLISTBYTASKID,
                 {
                     taskId: _tPId
                   , operation: ''
                 },
                 {
                     "success": function (data) {
                         _data = JSON.parse(data.body);
                         for (var i = 0; i < _data.length; i++) {
                             _saveData.StandardPicLst = $.unique(_saveData.StandardPicLst.concat(_data[i].SPicList));
                             _saveData.StandardAttachmentLst = $.unique(_saveData.StandardAttachmentLst.concat(_data[i].AttachmentList));
                             _saveData.CheckResultLst = $.unique(_saveData.CheckResultLst.concat(_data[i].CSList));
                             _saveData.PicStandLst = $.unique(_saveData.PicStandLst.concat(_data[i].PStandardList));
                             var scoreData = {
                                 TPId: _data[i].TPId, TIId: _data[i].TIId, Score: _data[i].Score, Remarks: _data[i].Remarks, PassYN: _data[i].PassYN
                                 , PlanApproalYN: _data[i].PlanApproalYN, ResultApproalYN: _data[i].ResultApproalYN, PlanFinishDate: _data[i].PlanFinishDate
                                 , ResultFinishDate: _data[i].ResultFinishDate
                             };
                             _saveData.ScoreLst.push(scoreData);
                         }
                         fn_BindData(_data, _tPId, _seqNo);
                         fn_InitControls();
                     },
                     "failure": function (data) {
                         $.sa.alert("查询失败");
                     }
                 }, $("body"));
        }
        function fn_BindData(data, _tPId, _seqNo) {
            for (var i = 0; i < data.length; i++) {
                if (data[i].TPId == _tPId && data[i].SeqNo == _seqNo) {
                    _tIId = data[i].TIId;// 保存当前的TIId
                    $("#inputSeqNo").val(data[i].SeqNo);
                    $("#inputItemNO").val(data[i].SeqNo);
                    $("#inputTitle").val(data[i].Title);
                    $("#inputMode").val(data[i].ExeMode);
                    $("#inputScoreStandard").val(data[i].ScoreStandard);
                    //$("#chkPlanApproalYN").prop("checked", data[i].PlanApproalYN);
                    //$("#chkResultApproalYN").prop("checked", data[i].ResultApproalYN);
                    _tpStatus = data[i].IsClicked;
                    if (data[i].IsClicked) {
                        $("#btnSave").attr("disabled", false);
                        $("#inputScore").attr("disabled", false);
                        $("#txtRemarks").attr("disabled", false);
                        //$("#divfile_upload").removeClass("hidden");
                        //$("#divfile_upload").parent().css("padding-top", "0px");

                    } else {
                        $("#btnSave").attr("disabled", true);
                        $("#inputScore").attr("disabled", true);
                        $("#txtRemarks").attr("disabled", true);
                        //$("#divfile_upload").addClass("hidden");
                        //$("#divfile_upload").parent().css("padding-top", "33px");
                    }
                    //fn_SetGrid(data[i].PStandardList);
                    //fn_SetGrid2(data[i].CSList);

                    break;
                }
            }
            //标准照片
            var tandardPicLst = [];
            for (var m = 0; m < _saveData.PicStandLst.length; m++) {
                if (_saveData.PicStandLst[m].TIId == _tIId) {
                    tandardPicLst.push(_saveData.PicStandLst[m]);
                }
            }
            fn_SetGrid(tandardPicLst);

            //失分照片
            var picList = [];
            for (var j = 0; j < _saveData.StandardPicLst.length; j++) {
                if (_saveData.StandardPicLst[j].TIId == _tIId && _saveData.StandardPicLst[j].Url != "") {
                    picList.push(_saveData.StandardPicLst[j]);
                }
            }
            fn_SetGrid3(picList);

            //附件
            var attachmentList = [];
            for (var a = 0; a < _saveData.StandardAttachmentLst.length; a++) {
                if (_saveData.StandardAttachmentLst[a].TIId == _tIId && _saveData.StandardAttachmentLst[a].Url != "") {
                    attachmentList.push(_saveData.StandardAttachmentLst[a]);
                }
            }
            fn_SetGrid4(attachmentList);

            var scList = [];
            for (var k = 0; k < _saveData.CheckResultLst.length; k++) {
                if (_saveData.CheckResultLst[k].TPId == _tPId && _saveData.CheckResultLst[k].SeqNo == _seqNo) {
                    scList.push(_saveData.CheckResultLst[k]);
                }
            }
            fn_SetGrid2(scList);

            //绑定分数和备注
            for (var h = 0; h < _saveData.ScoreLst.length; h++) {
                if (_saveData.ScoreLst[h].TPId == _tPId && _saveData.ScoreLst[h].TIId == _tIId) {
                    $("#inputScore").val(_saveData.ScoreLst[h].Score);
                    $("#txtRemarks").val(_saveData.ScoreLst[h].Remarks);
                    $("#txtPlanDate").val(_saveData.ScoreLst[h].PlanFinishDate.length > 10 ? _saveData.ScoreLst[h].PlanFinishDate.substring(0, 10) : _saveData.ScoreLst[h].PlanFinishDate);
                    $("#txtResultDate").val(_saveData.ScoreLst[h].ResultFinishDate.length > 10 ? _saveData.ScoreLst[h].ResultFinishDate.substring(0, 10) : _saveData.ScoreLst[h].ResultFinishDate);
                    $("#chkPlanApproalYN").prop("checked", _saveData.ScoreLst[h].PlanApproalYN);
                    $("#chkResultApproalYN").prop("checked", _saveData.ScoreLst[h].ResultApproalYN);
                    break;
                }
            }

        }
        function fn_ShowPic(cellvalue, options, rowObject) {
            if (!_tpStatus) {
                return "<a id='PV01' class='picName' href='" + rowObject.Url + "' data-lightbox='PreviewPicture' style='cursor: pointer;'> " + rowObject.PicName + "</a>";
            } else {
                //return "<a id='PV01' class='picName' href='" + rowObject.Url + "' data-lightbox='PreviewPicture' style='cursor: pointer;'> " + rowObject.PicName + "</a><a title='删除' href='#' onclick=fn_DeletePic('" + options.rowId + "')><i class='fa fa-trash-o fa-lg pull-right trash-space'></i></a>";
                return "<a id='PV01' class='picName' href='" + rowObject.Url + "' data-lightbox='PreviewPicture' style='cursor: pointer;'> " + rowObject.PicName + "</a>";
            }
        }
        function fn_UnShowPic(cellvalue, options, rowObject) {
            return rowObject.PicName;
        }
        function fn_DeletePic(rowId) {
            fn_SaveCell.call(_grid3);
            var editpicData = $("#gridPicUpload").jqGrid('getRowData', rowId);
            for (var i = 0; i < _saveData.StandardPicLst.length; i++) {
                if (_saveData.StandardPicLst[i].TIId == editpicData.TIId && _saveData.StandardPicLst[i].PicId == editpicData.PicId) {
                    //_saveData.StandardPicLst.splice(i, 1);
                    _saveData.StandardPicLst[i].Url = "";
                    break;
                }
            }

            _grid3.delRowData(rowId);
        }
        function fn_PreviewFile(cellvalue, options, rowObject) {
            var previewPath = rowObject.Url;
            var attachmentName = rowObject.AttachmentName;
            if (attachmentName.substr(attachmentName.lastIndexOf(".")) == ".gif" || attachmentName.substr(attachmentName.lastIndexOf(".")) == ".jpg" || attachmentName.substr(attachmentName.lastIndexOf(".")) == ".png")
                return "<a href='" + previewPath + "' data-lightbox='PreviewPicture'   style='margin-left: 15px; cursor: pointer; text-decoration: underline;'>" + rowObject.AttachmentName + "</a>";
            else {
                var url = '@Url.Action("DownLoadForRename", "Report")' + "?fileName=" + encodeURIComponent(attachmentName) + "&sourcepath=" + previewPath;
                return " <a href='" + url + "'  class='btn dotdotdot' style='text-align:left;' download='" + attachmentName + "'>" + attachmentName + "</a>";
            }
        }

        function fn_UnPreviewFile(cellvalue, options, rowObject) {
            return cellvalue;
        }
        function fn_DeleteAttachment(rowId) {
            fn_SaveCell.call(_grid4);
            var editAttachmentData = $("#gridAttachmentUpload").jqGrid('getRowData', rowId);
            for (var i = 0; i < _saveData.StandardAttachmentLst.length; i++) {
                if (_saveData.StandardAttachmentLst[i].TIId == editAttachmentData.TIId && _saveData.StandardAttachmentLst[i].AttachmentId == editAttachmentData.AttachmentId) {
                    _saveData.StandardAttachmentLst[i].Url = "";
                    break;
                }
            }

            _grid4.delRowData(rowId);
        }
        function fn_saveTempData() {
            fn_SaveCell.call(_grid2);//分数
            //var editData = _grid2.getChangedCells('all');
            var editData = _grid2.jqGrid("getRowData");
            for (var i = 0; i < _saveData.ScoreLst.length; i++) {
                var saveScoreRegDto = _saveData.ScoreLst[i];
                if (saveScoreRegDto.TPId == _tPId && saveScoreRegDto.TIId == _tIId) {
                    _saveData.ScoreLst[i].GRUD = "I";
                    _saveData.ScoreLst[i].Score = $("#inputScore").val();
                    _saveData.ScoreLst[i].Remarks = $("#txtRemarks").val();
                    _saveData.ScoreLst[i].PlanApproalYN = $("#chkPlanApproalYN").is(":checked");
                    _saveData.ScoreLst[i].ResultApproalYN = $("#chkResultApproalYN").is(":checked");
                    _saveData.ScoreLst[i].PlanFinishDate = $("#txtPlanDate").val();
                    _saveData.ScoreLst[i].ResultFinishDate = $("#txtResultDate").val();
                    break;
                }
            }
            //检查结果
            if (editData.length > 0) {
                for (var i = 0; i < editData.length; i++) {
                    var checkData = { TPId: _tPId, TIId: _tIId, CSId: editData[i].CSID, Result: editData[i].IsCheck, GRUD: "I" };
                    for (var j = 0; j < _saveData.CheckResultLst.length; j++) {
                        if (checkData.TPId == _saveData.CheckResultLst[j].TPId && checkData.TIId == _saveData.CheckResultLst[j].TIId && checkData.CSId == _saveData.CheckResultLst[j].CSID) {
                            _saveData.CheckResultLst[j].Result = checkData.Result;
                            _saveData.CheckResultLst[j].IsCheck = checkData.Result;
                            _saveData.CheckResultLst[j].GRUD = "I";
                            break;
                        }
                    }
                }

            }

            fn_SaveCell.call(_grid3);//图片上传
            //var editpicData = _grid3.getChangedCells('all');
            var editpicData = _grid3.jqGrid("getRowData");
            for (var m = 0; m < editpicData.length; m++) {
                var picData = { TIId: _tIId, TPId: _tPId, Url: editpicData[m].Url, PicName: editpicData[m].PicName, PicType: editpicData[m].PicType, PicId: editpicData[m].PicId, GRUD: "I" };
                var exitP = 0;
                for (var k = 0; k < _saveData.StandardPicLst.length; k++) {
                    if (picData.TIId == _saveData.StandardPicLst[k].TIId && picData.PicId == _saveData.StandardPicLst[k].PicId) {
                        exitP = 1;
                        _saveData.StandardPicLst[k].PicType = picData.PicType;
                        _saveData.StandardPicLst[k].Url = picData.Url;
                        _saveData.StandardPicLst[k].PicName = picData.PicName;
                        _saveData.StandardPicLst[k].GRUD = "I";
                        break;
                    }
                }
                if (exitP == 0) {
                    _saveData.StandardPicLst.push(picData);
                }
            }

            fn_SaveCell.call(_grid4);//附件上传
            var editAttachmentData = _grid4.jqGrid("getRowData");
            for (var a = 0; a < editAttachmentData.length; a++) {
                var attachmentData = { TIId: _tIId, TPId: _tPId, Url: editAttachmentData[a].Url, AttachmentName: editAttachmentData[a].AttachmentName, AttachmentType: editAttachmentData[a].AttachmentType, AttachmentId: editAttachmentData[a].AttachmentId, GRUD: "I" };
                var exitP = 0;
                for (var b = 0; b < _saveData.StandardAttachmentLst.length; b++) {
                    if (attachmentData.TIId == _saveData.StandardAttachmentLst[b].TIId && attachmentData.AttachmentId == _saveData.StandardAttachmentLst[b].AttachmentId) {
                        exitP = 1;
                        _saveData.StandardAttachmentLst[b].AttachmentType = attachmentData.AttachmentType;
                        _saveData.StandardAttachmentLst[b].Url = attachmentData.Url;
                        _saveData.StandardAttachmentLst[b].AttachmentName = attachmentData.AttachmentName;
                        _saveData.StandardAttachmentLst[b].GRUD = "I";
                        break;
                    }
                }
                if (exitP == 0) {
                    _saveData.StandardAttachmentLst.push(attachmentData);
                }
            }

            fn_SaveCell.call(_grid);//标准图片
            //var editPSPicData = _grid.getChangedCells('all');
            var editPSPicData = _grid.jqGrid("getRowData");
            for (var d = 0; d < editPSPicData.length; d++) {
                for (var r = 0; r < _saveData.PicStandLst.length; r++) {
                    if (editPSPicData[d].TPId == _saveData.PicStandLst[r].TPId && editPSPicData[d].TIId == _saveData.PicStandLst[r].TIId && editPSPicData[d].StandardPicId == _saveData.PicStandLst[r].StandardPicId) {
                        _saveData.PicStandLst[r].Url = editPSPicData[d].Url;
                        _saveData.PicStandLst[r].GRUD = "I";
                        break;
                    }
                }
            }

        }
        /*弃用*/
        function fn_saveTempData2() {
            fn_SaveCell.call(_grid2);//分数
            var editData = _grid2.getChangedCells('all');
            if (editData.length > 0) {
                var scoreRegDto = {
                    TPId: _tPId, TIId: _tIId, Score: score, GRUD: "I", Remarks: $("#txtRemarks").val(), PassYN: ""
                };
                for (var i = 0; i < _saveData.ScoreLst.length; i++) {
                    var saveScoreRegDto = _saveData.ScoreLst[i];
                    if (saveScoreRegDto.TPId == scoreRegDto.TPId && saveScoreRegDto.TIId == scoreRegDto.TIId) {
                        _saveData.ScoreLst.splice(i, 1)
                        _saveData.ScoreLst.push(scoreRegDto);
                        break;
                    }
                }
            }
            //检查结果
            if (editData.length > 0) {
                for (var i = 0; i < editData.length; i++) {
                    var checkData = { TPId: _tPId, TIId: _tIId, CSId: editData[i].CSID, Result: editData[i].IsCheck, GRUD: "I" };
                    for (var j = 0; j < _saveData.CheckResultLst.length; j++) {
                        if (checkData.TPId == _saveData.CheckResultLst[j].TPId && checkData.TIId == _saveData.CheckResultLst[j].TIId && checkData.CSId == _saveData.CheckResultLst[j].CSID) {
                            _saveData.CheckResultLst[j].Result = checkData.Result;
                            _saveData.CheckResultLst[j].IsCheck = checkData.Result;
                            _saveData.CheckResultLst[j].GRUD = "I";
                            break;
                        }
                    }
                }

            }

            fn_SaveCell.call(_grid3);//图片上传
            var editpicData = _grid3.getChangedCells('all');
            for (var m = 0; m < editpicData.length; m++) {
                var picData = { TIId: _tIId, TPId: _tPId, Url: editpicData[m].Url, PicName: editpicData[m].PicName, PicType: editpicData[m].PicType, PicId: editpicData[m].PicId };
                var exitP = 0;
                for (var k = 0; k < _saveData.StandardPicLst.length; k++) {
                    if (picData.TIId == _saveData.StandardPicLst[k].TIId && picData.PicId == _saveData.StandardPicLst[k].PicId) {
                        exitP = 1;
                        _saveData.StandardPicLst[k].PicType = picData.PicType;
                        _saveData.StandardPicLst[k].Url = picData.Url;
                        _saveData.StandardPicLst[k].PicName = picData.PicName;
                        break;
                    }
                }
                if (exitP == 0) {
                    _saveData.StandardPicLst.push(picData);
                }
            }

            fn_SaveCell.call(_grid4);//附件上传
            var editAttachmentData = _grid4.getChangedCells('all');
            for (var a = 0; a < editAttachmentData.length; a++) {
                var attachmentData = { TIId: _tIId, TPId: _tPId, Url: editAttachmentData[a].Url, AttachmentName: editAttachmentData[a].AttachmentName, AttachmentType: editAttachmentData[a].AttachmentType, AttachmentId: editAttachmentData[a].AttachmentId };
                var exitP = 0;
                for (var b = 0; b < _saveData.StandardAttachmentLst.length; b++) {
                    if (attachmentData.TIId == _saveData.StandardAttachmentLst[b].TIId && attachmentData.AttachmentId == _saveData.StandardAttachmentLst[b].AttachmentId) {
                        exitP = 1;
                        _saveData.StandardAttachmentLst[b].PicType = attachmentData.PicType;
                        _saveData.StandardAttachmentLst[b].Url = attachmentData.Url;
                        _saveData.StandardAttachmentLst[b].PicName = attachmentData.PicName;
                        break;
                    }
                }
                if (exitP == 0) {
                    _saveData.StandardAttachmentLst.push(attachmentData);
                }
            }

            fn_SaveCell.call(_grid);//标准图片
            var editPSPicData = _grid.getChangedCells('all');
            for (var d = 0; d < editPSPicData.length; d++) {
                for (var r = 0; r < _saveData.PicStandLst.length; r++) {
                    if (editPSPicData[d].TPId == _saveData.PicStandLst[r].TPId && editPSPicData[d].TIId == _saveData.PicStandLst[r].TIId && editPSPicData[d].StandardPicId == _saveData.PicStandLst[r].StandardPicId) {
                        //_saveData.PicStandLst[r].Url = editPSPicData[d].Url.indexOf("href") > -1 && editPSPicData[d].Url.split('"').length > 4 ? editPSPicData[d].Url.split('"')[3] : editPSPicData[d].Url;
                        _saveData.PicStandLst[r].Url = editPSPicData[d].Url;
                        break;
                    }
                }
            }
            //备注
            for (var y = 0; y < _saveData.ScoreLst.length; y++) {
                if (_saveData.ScoreLst[y].TPId == _tPId && _saveData.ScoreLst[y].TIId == _tIId) {
                    _saveData.ScoreLst[y].Remarks = $("#txtRemarks").val();
                    _saveData.ScoreLst[y].GRUD = "I";
                    _saveData.ScoreLst[y].Score = $("#inputScore").val();
                    break;
                }
            }

        }
        //得分Change事件
        function fn_ScoreChange() {
            //Jqgrid 需要保存一下，然后把选择的值赋回去
            var selectValue = $("#inputScore").val();
            fn_SaveCell.call(_grid2);//分数
            $("#inputScore").val(selectValue);
            //for (var i = 0; i < _saveData.ScoreLst.length; i++) {
            //    if (_saveData.ScoreLst[i].TPId == _tPId && _saveData.ScoreLst[i].TIId == _tIId) {
            //        _saveData.ScoreLst[i].Score = isNaN($("#inputScore").val()) ? 0 : $("#inputScore").val();
            //        _saveData.ScoreLst[i].GRUD = "I";
            //    }
            //}
        }
        function fn_ShowStandardPic(cellvalue, options, rowObject) {
            //var str = "<input type='file' name='file_upload" + options.rowId + "' id='file_upload" + options.rowId + "'>";
            var str = "<div id='ossfile" + options.rowId + "'></div>"
                   + "<div id='container" + options.rowId + "' style='padding-left:5px;'>"
                   + "<a id='selectfiles" + options.rowId + "' href='javascript:void(0);' class='btn btn-primary' style='height:35px;'>上传</a>"
                   + "<a id='postfiles" + options.rowId + "' href='javascript:void(0);' class='btn' style='display:none'>开始上传</a>"
                   + "</div>";
            return str;
        }
        function fn_UnShowStandardPic(cellvalue, options, rowObject) {
            return "";
        }

        function fn_AddStandardPic(id, picName, path) {
            var rowData = $("#gridStandardPic").jqGrid('getRowData', id);
            _grid.setCell(id, 'Url', path);
            var cellValue = "<a  class='picName' href='" + path + "' data-lightbox='PreviewPicture' style='cursor: pointer;padding-left:10px'>" + rowData.StandardPicName + "</a>";
            _grid.setCell(id, 'StandardPicName', cellValue);

            var delCellValue = "<a title='删除' href='#' onclick=fn_DeleteStandPic('" + id + "')><i class='fa fa-trash-o fa-lg pull-right trash-space'></i></a>";
            _grid.setCell(id, 'Delete', delCellValue);

            $(_grid.getGridRowById(id)).addClass("edited");
        }
        // 删除标准图片
        function fn_DeleteStandPic(rowId) {
            var editpicData = $("#gridStandardPic").jqGrid('getRowData', rowId);
            for (var i = 0; i < _saveData.PicStandLst.length; i++) {
                if (_saveData.PicStandLst[i].TIId == editpicData.TIId && _saveData.PicStandLst[i].StandardPicId == editpicData.StandardPicId) {
                    $("#gridStandardPic").find("[id=" + rowId + "]").find("[aria-describedby=gridStandardPic_Url]").html("");
                    $("#gridStandardPic").find("[id=" + rowId + "]").find("[aria-describedby=gridStandardPic_Delete]").html("");
                    $("#gridStandardPic").find("[id=" + rowId + "]").find("[aria-describedby=gridStandardPic_StandardPicName]").html($("#gridStandardPic").find("[id=" + rowId + "]").find("[aria-describedby=gridStandardPic_StandardPicName]").attr("title"));
                    _saveData.PicStandLst[i].Url = "";
                    break;
                }
            }
            $(_grid.getGridRowById(rowId)).addClass("edited");
        }

    </script>

    <!-- 5. Grid -->
    <script type="text/javascript">
        function fn_GridInit() {
            _grid.jqGrid({
                datatype: 'local',
                colModel: [
                        {
                            name: 'StandardPicName', label: "照片名称", width: 200, align: 'left'
                             , formatter: function (cellvalue, options, rowObject) {
                                 if (cellvalue.indexOf("href") > -1) {
                                     return cellvalue;
                                 } else if (rowObject.Url != undefined && rowObject.Url != null && rowObject.Url != "") {
                                     return "<a  class='picName' href='" + rowObject.Url + "' data-lightbox='PreviewPicture' style='cursor: pointer;padding-left:10px'>" + rowObject.StandardPicName + "</a>";
                                 } else {
                                     return rowObject.StandardPicName;
                                 }

                             }, unformat: function (cellvalue, options, rowObject) {
                                 return rowObject.StandardPicName;
                             }, cellattr: function (rowId, val, rawObject, cm, rdata) {
                                 return 'class="readonlycell"';
                             }
                        },
                        {
                            name: 'Upload', label: "上传", width: 60, align: 'center',
                            formatter: fn_ShowStandardPic, unformat: fn_UnShowStandardPic
                        },
                        {
                            name: 'Delete', label: "删除", width: 40, align: 'left'
                            , formatter: function (cellvalue, options, rowObject) {
                                if (_tpStatus && rowObject.Url != undefined && rowObject.Url != null && rowObject.Url != "") {
                                    return "<a title='删除' href='#' onclick=fn_DeleteStandPic('" + options.rowId + "')><i class='fa fa-trash-o fa-lg pull-right trash-space'></i></a>";
                                } else {
                                    return cellvalue == null ? "" : cellvalue;
                                }

                            }, unformat: function (cellvalue, options, rowObject) {
                                return "";
                            }
                        },
                        {
                            name: 'Url', label: "预览", width: 40, align: 'left', hidden: true
                        }, {
                            name: 'StandardPicId', label: "StandardPicId", width: 50, align: 'center', hidden: true
                        }, {
                            name: 'TPId', label: "TPId", width: 50, align: 'center', hidden: true

                        }, {
                            name: 'TIId', label: "TIId", width: 50, align: 'center', hidden: true
                        }

                ],
                width: $('#Grid1').width(),
                height: 'auto',
                rownumbers: true,
                rownumWidth: 30,
                rowNum: 50,
                rowList: [50, 60, 70],
                footerrow: false,
                cellsubmit: 'clientArray',
                //pager: jQuery('#pager1'),
                cellEdit: true,
                editurl: 'clientArray',
                viewrecords: true,
                gridComplete: function (id) {
                    var rowNum = parseInt($(this).getGridParam("records"), 10);
                    if (rowNum > 0) {
                        $(".ui-jqgrid-sdiv").show();
                    }
                    else {
                        $(".ui-jqgrid-sdiv").hide();
                    }
                    $('#pager1_left').css('width', '25%');
                    $('#pager1_right').css('width', '25%');

                    $("[aria-describedby='gridStandardPic_rn']").addClass("readonlycell");

                },
                afterInsertRow: function (id) {
                    var uploader = new plupload.Uploader({
                        runtimes: 'html5,flash,silverlight,html4',
                        browse_button: 'selectfiles' + id,
                        multi_selection: false,
                        container: document.getElementById('container' + id),
                        flash_swf_url: 'lib/plupload-2.1.2/js/Moxie.swf',
                        silverlight_xap_url: 'lib/plupload-2.1.2/js/Moxie.xap',
                        url: 'http://oss.aliyuncs.com',

                        resize: {
                            quality: 50
                        },
                        init: {
                            PostInit: function () {
                                document.getElementById('ossfile' + id).innerHTML = '';
                                document.getElementById('postfiles' + id).onclick = function () {
                                    set_upload_param(uploader, '', false);
                                    return false;
                                };
                            },

                            FilesAdded: function (up, files) {
                                document.getElementById('postfiles' + id).click();
                            },
                            FilesRemoved: function (up, files) {
                                $item = $("#" + files[0].id);
                                $item.find('.data').removeClass('data').html(' - 上传取消中');
                                $item.find('.uploadify-progress-bar').remove();
                                $item.delay(1000).fadeOut(500, function () {
                                    $(this).remove();
                                });
                            },
                            BeforeUpload: function (up, file) {
                                set_upload_param(up, file.name, true);
                            },

                            UploadProgress: function (up, file) {

                            },

                            FileUploaded: function (up, file, info) {
                                if (info.status == 200) {
                                    setTimeout(function () {
                                        if ($('#' + file.id)) {
                                            up.total.size -= file.size;
                                            up.total.uploaded -= 1;
                                            delete up.files[file.id]
                                            $('#' + file.id).fadeOut(500, function () {
                                                $(this).remove();
                                            });
                                        }
                                    }, 1000);
                                    var picName = file.name;
                                    fn_AddStandardPic(id, picName, host + g_dirname + g_object_name);
                                }
                                else {
                                    document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = info.response;
                                }
                            },

                            Error: function (up, err) {
                                console.log(document.createTextNode("\nError xml:" + err.response));
                                console.log(err.response);
                            }
                        }
                    });
                    uploader.init();
                }
            });
        }
        function fn_SetGrid(mydata) {
            mydata = mydata || [];
            _grid.clearGridData()
                .setGridParam({
                    data: mydata
                }).trigger('reloadGrid');
            localdata = mydata;
        }

        function fn_GridInit2() {
            _grid2.jqGrid({
                datatype: 'local',
                colModel: [
                        {
                            name: 'CContent', label: "检查标准", width: 200, align: 'left',
                            cellattr: function (rowId, val, rawObject, cm, rdata) {
                                return 'class="readonlycell"';
                            }
                        },
                        {
                            name: 'IsCheck', label: '结果', width: 40, align: 'center', editable: true, edittype: "text"
                            , formatter: 'select', edittype: 'select',
                            formatoptions: {
                                value: { "true": "是", "false": "否" }
                            }, editoptions: {
                                'class': 'form-control',
                                value: { "true": "是", "false": "否" }
                            }

                        },
                        {
                            name: 'CSID', label: "CSID", width: 60, align: 'left', hidden: true,
                            cellattr: function (rowId, val, rawObject, cm, rdata) {
                                return 'class="readonlycell"';
                            }
                        }

                ],
                width: $('#Grid2').width(),
                height: 'auto',
                rownumbers: true,
                rownumWidth: 30,
                rowNum: 50,
                rowList: [50, 60, 70],
                footerrow: false,
                cellsubmit: 'clientArray',
                //pager: jQuery('#pager2'),
                cellEdit: true,
                editurl: 'clientArray',
                viewrecords: true,
                gridComplete: function (id) {
                    var rowNum = parseInt($(this).getGridParam("records"), 10);
                    if (rowNum > 0) {
                        $(".ui-jqgrid-sdiv").show();
                    }
                    else {
                        $(".ui-jqgrid-sdiv").hide();
                    }
                    $('#pager2_left').css('width', '25%');
                    $('#pager2_right').css('width', '25%');

                    $("[aria-describedby='gridCheckStandard_rn']").addClass("readonlycell");

                }, afterSaveCell: function (rowid, name, val, iRow, iCol) {
                    var rowdata = $("#gridCheckStandard").jqGrid("getRowData");
                    var trueCnt = 0;
                    var nullCnt = 0;
                    for (var i = 0; i < rowdata.length; i++) {
                        if (rowdata[i].IsCheck == "true") {
                            trueCnt++;
                        } else if (rowdata[i].IsCheck == "") {
                            nullCnt++;
                        }
                    }
                    if (trueCnt > 0) {
                        $("#inputScore").val(0);
                    } else {
                        $("#inputScore").val(1);
                    }
                }, onCellSelect: function (rowid, iCol, cellcontent, e) {
                    if (!_tpStatus) {
                        $("#gridCheckStandard").setColProp('IsCheck', { 'editable': false });
                    } else {
                        $("#gridCheckStandard").setColProp('IsCheck', { 'editable': true });
                    }
                }, afterInsertRow: function (rowid, r) {
                    var $t = $(this);
                    if (!_tpStatus) {
                        $t.find('#' + rowid).find("[aria-describedby='gridCheckStandard_IsCheck']").addClass("readonlycell");
                    }

                }
            });
        }
        function fn_SetGrid2(mydata) {
            mydata = mydata || [];
            _grid2.clearGridData()
                .setGridParam({
                    data: mydata
                }).trigger('reloadGrid');
            localdata = mydata;
        }

        function fn_GridInit3() {
            _grid3.jqGrid({
                datatype: 'local',
                colModel: [
                        {
                            name: 'PicType', label: '类型', width: 40, align: 'center', editable: true, edittype: "text", hidden: true
                            , formatter: 'select', edittype: 'select',
                            formatoptions: {
                                value: { "L": "失分", "G": "标准" }
                            }, editoptions: {
                                'class': 'form-control',
                                value: { "L": "失分", "G": "标准" }
                            }

                        },
                        {
                            name: 'PicName', label: '照片名', width: 50, align: 'left', editable: false,
                            formatter: fn_ShowPic, unformat: fn_UnShowPic
                        },
                        {
                            name: 'Delete', label: "删除", width: 15, align: 'center'
                            , formatter: function (cellvalue, options, rowObject) {
                                return "<a title='删除' href='#' onclick=fn_DeletePic('" + options.rowId + "')><i class='fa fa-trash-o fa-lg'></i></a>";
                            }, unformat: function (cellvalue, options, rowObject) {
                                return "";
                            }
                        },
                        {
                            name: 'Url', label: 'Url', width: 50, align: 'left', editable: false, hidden: true
                        },
                        {
                            name: 'PicName', label: 'Url', width: 50, align: 'left', editable: false, hidden: true
                        },
                        {
                            name: 'PicId', label: 'Url', width: 50, align: 'left', editable: false, hidden: true
                        },
                        {
                            name: 'TIId', label: 'TIId', width: 50, align: 'left', editable: false, hidden: true
                        }

                ],
                width: $('#Grid3').width(),
                height: 'auto',
                rownumbers: true,
                rownumWidth: 30,
                rowNum: 50,
                rowList: [50, 60, 70],
                footerrow: false,
                cellsubmit: 'clientArray',
                //pager: jQuery('#pager3'),
                cellEdit: true,
                editurl: 'clientArray',
                viewrecords: true,
                gridComplete: function (id) {
                    var rowNum = parseInt($(this).getGridParam("records"), 10);
                    if (rowNum > 0) {
                        $(".ui-jqgrid-sdiv").show();
                    }
                    else {
                        $(".ui-jqgrid-sdiv").hide();
                    }
                    $('#pager3_left').css('width', '25%');
                    $('#pager3_right').css('width', '25%');

                    $("[aria-describedby='gridPicUpload_rn']").addClass("readonlycell");
                }, onCellSelect: function (rowid, iCol, cellcontent, e) {

                }
            });
        }
        function fn_SetGrid3(mydata) {
            mydata = mydata || [];
            _grid3.clearGridData()
                .setGridParam({
                    data: mydata
                }).trigger('reloadGrid');
            localdata = mydata;
        }

        function fn_GridInit4() {
            _grid4.jqGrid({
                datatype: 'local',
                colModel: [
                        {
                            name: 'AttachmentName', label: '附件名', width: 50, align: 'left', editable: false,
                            formatter: fn_PreviewFile, unformat: fn_UnPreviewFile
                        },
                        {
                            name: 'Delete', label: "删除", width: 15, align: 'center'
                            , formatter: function (cellvalue, options, rowObject) {
                                return "<a title='删除' href='#' onclick=fn_DeleteAttachment('" + options.rowId + "')><i class='fa fa-trash-o fa-lg'></i></a>";
                            }, unformat: function (cellvalue, options, rowObject) {
                                return "";
                            }
                        },
                        {
                            name: 'Url', label: 'Url', width: 50, align: 'left', editable: false, hidden: true
                        },
                        {
                            name: 'AttachmentName', label: 'Url', width: 50, align: 'left', editable: false, hidden: true
                        },
                        {
                            name: 'AttachmentId', label: 'Url', width: 50, align: 'left', editable: false, hidden: true
                        },
                        {
                            name: 'TIId', label: 'TIId', width: 50, align: 'left', editable: false, hidden: true
                        }

                ],
                width: $('#Grid4').width(),
                height: 'auto',
                rownumbers: true,
                rownumWidth: 30,
                rowNum: 50,
                rowList: [50, 60, 70],
                footerrow: false,
                cellsubmit: 'clientArray',
                //pager: jQuery('#pager3'),
                cellEdit: true,
                editurl: 'clientArray',
                viewrecords: true,
                gridComplete: function (id) {
                    var rowNum = parseInt($(this).getGridParam("records"), 10);
                    if (rowNum > 0) {
                        $(".ui-jqgrid-sdiv").show();
                    }
                    else {
                        $(".ui-jqgrid-sdiv").hide();
                    }
                    $('#pager4_left').css('width', '25%');
                    $('#pager4_right').css('width', '25%');

                    $("[aria-describedby='gridAttachmentUpload_rn']").addClass("readonlycell");
                }, onCellSelect: function (rowid, iCol, cellcontent, e) {

                }
            });
        }
        function fn_SetGrid4(mydata) {
            mydata = mydata || [];
            _grid4.clearGridData()
                .setGridParam({
                    data: mydata
                }).trigger('reloadGrid');
            localdata = mydata;
        }

        function fn_SaveCell() {
            var $t = $(this);
            var $ecs = $(".edit-cell", $t);
            $ecs.each(function (idx, ec) {
                var iRow = $(ec).parent().index();
                var iCol = $(ec).index();
                $t.saveCell(iRow, iCol);
            });
        }
    </script>

    <!-- 6. Upload-->
    <script type="text/javascript">
        //upload
        var uploader1;//上传附件
        var uploader2;//上传失分照片
        $(document).ready(function () {
            uploader1 = new plupload.Uploader({
                runtimes: 'html5,flash,silverlight,html4',
                browse_button: 'selectfiles_1',
                multi_selection: true,
                container: document.getElementById('container_1'),
                flash_swf_url: 'lib/plupload-2.1.2/js/Moxie.swf',
                silverlight_xap_url: 'lib/plupload-2.1.2/js/Moxie.xap',
                url: 'http://oss.aliyuncs.com',

                resize: {
                    quality: 50
                },
                init: {
                    PostInit: function () {
                        document.getElementById('ossfile_1').innerHTML = '';
                        document.getElementById('postfiles_1').onclick = function () {
                            set_upload_param(uploader1, '', false);
                            return false;
                        };
                    },

                    FilesAdded: function (up, files) {
                        plupload.each(files, function (file) {
                            document.getElementById('ossfile_1').innerHTML += '<div id="' + file.id + '" class="uploadify-queue-item">\
					<div class="cancel">\
						<a href="" onclick="javascript:uploader1.removeFile(\'' + file.id + '\'); return false;">X</a>\
					</div>\
					<span class="fileName">' + file.name + ' (' + plupload.formatSize(file.size) + ')</span><span class="data"></span>\
					<div class="uploadify-progress">\
						<div class="uploadify-progress-bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>\
					</div>\
				</div>';
                        });
                        document.getElementById('postfiles_1').click();
                    },
                    FilesRemoved: function (up, files) {
                        $item = $("#" + files[0].id);
                        $item.find('.data').removeClass('data').html(' - 上传取消中');
                        $item.find('.uploadify-progress-bar').remove();
                        $item.delay(1000).fadeOut(500, function () {
                            $(this).remove();
                        });
                    },
                    BeforeUpload: function (up, file) {
                        set_upload_param(up, file.name, true);
                    },

                    UploadProgress: function (up, file) {
                        var d = document.getElementById(file.id);
                        d.getElementsByTagName('span')[1].innerHTML = '<span>' + file.percent + "%</span>";
                        var prog = d.getElementsByTagName('div')[1];
                        var progBar = prog.getElementsByTagName('div')[0]
                        progBar.style.width = file.percent + '%';
                        progBar.setAttribute('aria-valuenow', file.percent);
                    },

                    FileUploaded: function (up, file, info) {
                        if (info.status == 200) {
                            setTimeout(function () {
                                if ($('#' + file.id)) {
                                    up.total.size -= file.size;
                                    up.total.uploaded -= 1;
                                    delete up.files[file.id]
                                    $('#' + file.id).fadeOut(500, function () {
                                        $(this).remove();
                                    });
                                }
                            }, 1000);
                            fn_Addrow_1(file.name, g_object_name);
                        }
                        else {
                            document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = info.response;
                        }
                    },

                    Error: function (up, err) {
                        console.log(document.createTextNode("\nError xml:" + err.response));
                        console.log(err.response);
                    }
                }
            });
            uploader1.init();

            uploader2 = new plupload.Uploader({
                runtimes: 'html5,flash,silverlight,html4',
                browse_button: 'selectfiles0',
                multi_selection: false,
                container: document.getElementById('container0'),
                flash_swf_url: 'lib/plupload-2.1.2/js/Moxie.swf',
                silverlight_xap_url: 'lib/plupload-2.1.2/js/Moxie.xap',
                url: 'http://oss.aliyuncs.com',

                resize: {
                    quality: 50
                },
                init: {
                    PostInit: function () {
                        document.getElementById('ossfile0').innerHTML = '';
                        document.getElementById('postfiles0').onclick = function () {
                            set_upload_param(uploader2, '', false);
                            return false;
                        };
                    },

                    FilesAdded: function (up, files) {
                        plupload.each(files, function (file) {
                            document.getElementById('ossfile0').innerHTML += '<div id="' + file.id + '" class="uploadify-queue-item">\
					<div class="cancel">\
						<a href="" onclick="javascript:uploader2.removeFile(\'' + file.id + '\'); return false;">X</a>\
					</div>\
					<span class="fileName">' + file.name + ' (' + plupload.formatSize(file.size) + ')</span><span class="data"></span>\
					<div class="uploadify-progress">\
						<div class="uploadify-progress-bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>\
					</div>\
				</div>';
                        });
                        document.getElementById('postfiles0').click();
                    },
                    FilesRemoved: function (up, files) {
                        $item = $("#" + files[0].id);
                        $item.find('.data').removeClass('data').html(' - 上传取消中');
                        $item.find('.uploadify-progress-bar').remove();
                        $item.delay(1000).fadeOut(500, function () {
                            $(this).remove();
                        });
                    },
                    BeforeUpload: function (up, file) {
                        set_upload_param(up, file.name, true);
                    },

                    UploadProgress: function (up, file) {
                        var d = document.getElementById(file.id);
                        d.getElementsByTagName('span')[1].innerHTML = '<span>' + file.percent + "%</span>";
                        var prog = d.getElementsByTagName('div')[1];
                        var progBar = prog.getElementsByTagName('div')[0]
                        progBar.style.width = file.percent + '%';
                        progBar.setAttribute('aria-valuenow', file.percent);
                    },

                    FileUploaded: function (up, file, info) {
                        if (info.status == 200) {
                            setTimeout(function () {
                                if ($('#' + file.id)) {
                                    up.total.size -= file.size;
                                    up.total.uploaded -= 1;
                                    delete up.files[file.id]
                                    $('#' + file.id).fadeOut(500, function () {
                                        $(this).remove();
                                    });
                                }
                            }, 1000);
                            fn_Addrow(file.name, g_object_name);
                        }
                        else {
                            document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = info.response;
                        }
                    },

                    Error: function (up, err) {
                        console.log(document.createTextNode("\nError xml:" + err.response));
                        console.log(err.response);
                    }
                }
            });
            uploader2.init();
        });

        function fn_Addrow(picName, key) {
            var ids = _grid3.getDataIDs();
            var pref = $.jgrid.uidPref;
            var newid = 1;
            if (ids && ids.length > 0) {
                var regx = new RegExp(pref, 'g');
                var nids = ids.join(',').replace(regx, '').split(',');
                var maxid = Math.max.apply(Math, nids);
                newid = maxid + 1;
            }
            newid = pref + (newid).toString();
            var rowdata = {
                PreView: picName,
                Url: host + g_dirname + key,
                PicId: newid,
                TIId: _tIId,
                PicName: picName,
                PicType: "L"
            };
            _grid3.addRowData(newid, rowdata, 'last');
            $(_grid3.getGridRowById(newid)).addClass("edited");
        }

        function fn_Addrow_1(attachmentName, key) {
            var ids = _grid4.getDataIDs();
            var pref = $.jgrid.uidPref;
            var newid = 1;
            if (ids && ids.length > 0) {
                var regx = new RegExp(pref, 'g');
                var nids = ids.join(',').replace(regx, '').split(',');
                var maxid = Math.max.apply(Math, nids);
                newid = maxid + 1;
            }
            newid = pref + (newid).toString();
            var rowdata = {
                PreView: attachmentName,
                Url: host + g_dirname + key,
                AttachmentId: newid,
                TIId: _tIId,
                AttachmentName: attachmentName,
                AttachmentType: ""
            };
            _grid4.addRowData(newid, rowdata, 'last');
            $(_grid4.getGridRowById(newid)).addClass("edited");
        }

    </script>
}
<div class="row  gap-top">
    <div class="col-md-12">
        <div class="pull-right">
            <button type="button" class="btn btn-primary" id="btnPre">
                <span class="fa fa-arrow-circle-o-left gap-icon"></span>上一题
            </button>
            <button type="button" class="btn btn-primary" id="btnNext">
                <span class="fa fa-arrow-circle-o-right gap-icon"></span>下一题
            </button>
            <button type="button" class="btn btn-primary" id="btnQuit">
                <span class="fa fa-times-circle-o gap-icon"></span>不涉及
            </button>
            <button type="button" class="btn btn-primary" id="btnGoto">
                <span class="fa fa-chevron-circle-right gap-icon"></span>跳转到
            </button>
            <input type="text" class="form-control" id="inputNo">
            <button type="button" class="btn btn-primary" id="btnSave">
                <span class="fa fa-save gap-icon"></span>保存
            </button>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-4  col-sm-6  gap-top">
        <div class="input-group">
            <label class="input-group-addon title-xs">体系号</label>
            <input type="text" class="form-control" id="inputItemNO" disabled>
        </div>
    </div>
    <div class="col-md-4  col-sm-6  gap-top">
        <div class="input-group">
            <label class="input-group-addon title-xs">执行顺序</label>
            <input type="text" class="form-control" id="inputSeqNo" disabled>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-12  col-sm-12  gap-top">
        <div class="input-group">
            <label class="input-group-addon title-xs">指标名称</label>
            <input type="text" class="form-control" style="max-width:100%;" id="inputTitle" disabled>
        </div>
    </div>

</div>
<div class="row">
    <div class="col-md-4  col-sm-6  gap-top">
        <div class="input-group">
            <label class="input-group-addon title-xs">执行方式</label>
            <input type="text" class="form-control" id="inputMode" disabled>
        </div>
    </div>
    <div class="col-md-4  col-sm-6  gap-top">
        <div class="input-group">
            <label class="input-group-addon title-xs">评分标准</label>
            <input type="text" class="form-control" id="inputScoreStandard" disabled>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-4  col-sm-6" style="padding-top:10px;">
        <div class="input-group">
            <label class="input-group-addon title-xs">计划审批</label>
            <div class="form-control">
                <label class="checkbox-inline">
                    <input type="checkbox" id="chkPlanApproalYN" />&nbsp;
                </label>
            </div>
        </div>
    </div>
    <div class="col-md-4  col-sm-6" style="padding-top:10px;">
        <div class="input-group">
            <label class="input-group-addon title-xs">完成日期</label>
            <div class="input-group">
                <input type="text" class="form_datetime form-control" id="txtPlanDate" />
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-4  col-sm-6" style="padding-top:10px;">
        <div class="input-group">
            <label class="input-group-addon title-xs">结果审批</label>
            <div class="form-control">
                <label class="checkbox-inline">
                    <input type="checkbox" id="chkResultApproalYN" />&nbsp;
                </label>
            </div>
        </div>
    </div>
    <div class="col-md-4  col-sm-6" style="padding-top:10px;">
        <div class="input-group">
            <label class="input-group-addon title-xs">完成日期</label>
            <div class="input-group">
                <input type="text" class="form_datetime form-control" id="txtResultDate" />
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-md-4  col-sm-6" style="padding-top:10px;">
        <div class="input-group">
            <label class="input-group-addon title-xs">备注</label>
            <textarea id="txtRemarks" class="form-control"></textarea>
        </div>
    </div>
    <div class="col-md-4  col-sm-6" style="padding-top:10px;">
        <div class="input-group">
            <label class="input-group-addon title-xs">得分</label>
            <input type="text" class="form-control" id="inputScore">
            @*<select id="inputScore" class="form-control">
                    <option value="-1"></option>
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="99">99</option>
                </select>*@
        </div>
    </div>
</div>
<div class="row" style="padding-top:5px;">
    <div class="col-md-6  col-sm-6  gap-top">
        <div style="padding-left:5px; padding-top:13px;"><span class="fa fa-angle-double-right">检查标准</span></div>
        <div id="Grid2" class="col-md-6">
            <table id="gridCheckStandard" class="ui-jqgrid-htable"></table>
            <div id="pager2" class="page">
            </div>
        </div>
    </div>
    <div class="col-md-6  col-sm-6  gap-top">
        <div id="ossfile_1"></div>
        <div id="container_1" style="padding-left:5px;">
            <a id="selectfiles_1" href="javascript:void(0);" class='btn btn-primary'><span class="fa fa-cloud-upload gap-icon"></span>上传附件</a>
            <a id="postfiles_1" href="javascript:void(0);" class='btn' style="display:none">开始上传</a>
        </div>
        <div id="Grid4" class="col-md-6">
            <table id="gridAttachmentUpload" class="ui-jqgrid-htable"></table>
            <div id="pager4" class="page">
            </div>
        </div>
    </div>
</div>
<div class="row" style="padding-top:5px;">
    <div class="col-md-6  col-sm-6  gap-top">
        <div style="padding-left:5px;padding-top:13px;"><span class="fa fa-angle-double-right">现场照片</span></div>
        <div id="Grid1" class="col-md-6">
            <table id="gridStandardPic" class="ui-jqgrid-htable"></table>
            <div id="pager1" class="page">
            </div>
        </div>
    </div>
    <div class="col-md-6  col-sm-6  gap-top">
        <div id="ossfile0"></div>
        <div id="container0" style="padding-left:5px;">
            <a id="selectfiles0" href="javascript:void(0);" class='btn btn-primary'><span class="fa fa-cloud-upload gap-icon"></span>上传失分照片</a>
            <a id="postfiles0" href="javascript:void(0);" class='btn' style="display:none">开始上传</a>
        </div>

        <div id="Grid3" class="col-md-6">
            <table id="gridPicUpload" class="ui-jqgrid-htable"></table>
            <div id="pager3" class="page">
            </div>
        </div>
    </div>
</div>



